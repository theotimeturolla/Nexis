name: Nexus Daily Run

on:
  schedule:
    # Lance le robot tous les jours Ã  07:00 UTC (08:00 en France)
    - cron: '0 7 * * *'
  workflow_dispatch: # Permet le lancement manuel via le bouton

permissions:
  contents: write

jobs:
  run-nexus:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ RÃ©cupÃ©ration du code
      uses: actions/checkout@v3

    - name: ğŸ Installation Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: ğŸ“¦ Installation des dÃ©pendances
      run: |
        # On installe les bibliothÃ¨ques listÃ©es dans backend/requirements.txt
        pip install -r backend/requirements.txt
        # On installe le dictionnaire franÃ§ais pour l'IA
        python -m spacy download fr_core_news_md

    - name: ğŸ§  Restauration de la mÃ©moire
      continue-on-error: true
      run: |
        git config user.name "Nexus Bot"
        git config user.email "bot@nexus.ai"
        git pull origin main

    - name: ğŸ¤– Lancement du Robot
      env:
        RESEND_API_KEY: ${{ secrets.RESEND_API_KEY }}
        PYTHONPATH: ${{ github.workspace }}/backend
      run: |
        # Initialisation de la base de donnÃ©es (au cas oÃ¹)
        python backend/init_db.py
        # Lancement du script principal
        python main.py

    - name: ğŸ’¾ Sauvegarde de la mÃ©moire
      if: success()
      run: |
        git add nexis.db
        git commit -m "ğŸ§  Mise Ã  jour mÃ©moire [skip ci]" || echo "Rien Ã  changer"
        git push