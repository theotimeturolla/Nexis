name: Nexus Daily Run

on:
  schedule:
    # Lance le robot tous les jours √† 07:00 UTC (08:00 en France)
    - cron: '0 7 * * *'
  workflow_dispatch: # Permet le lancement manuel via le bouton

permissions:
  contents: write

jobs:
  run-nexus:
    runs-on: ubuntu-latest

    steps:
    - name: üì• R√©cup√©ration du code
      uses: actions/checkout@v3

    - name: üêç Installation Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: üì¶ Installation des d√©pendances
      run: |
        pip install -r backend/requirements.txt
        # On installe le mod√®le DIRECTEMENT (plus s√ªr)
        pip install https://github.com/explosion/spacy-models/releases/download/fr_core_news_md-3.7.0/fr_core_news_md-3.7.0-py3-none-any.whl

    - name: üß† Restauration de la m√©moire
      continue-on-error: true
      run: |
        git config user.name "Nexus Bot"
        git config user.email "bot@nexus.ai"
        git pull origin main

    - name: ü§ñ Lancement du Robot
      env:
        RESEND_API_KEY: ${{ secrets.RESEND_API_KEY }}
        PYTHONPATH: ${{ github.workspace }}/backend
      run: |
        # Initialisation de la base de donn√©es (au cas o√π)
        python backend/init_db.py
        # Lancement du script principal
        python main.py

    - name: üíæ Sauvegarde de la m√©moire
      if: success()
      run: |
        git add nexis.db
        git commit -m "üß† Mise √† jour m√©moire [skip ci]" || echo "Rien √† changer"
        git push